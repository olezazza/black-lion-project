{% extends "base.html" %}
{% block content %}

<style>
    /* Neon Theme */
    .neon-text { color: #d8e377 !important; }
    .neon-bg { background-color: #d8e377 !important; color: #000 !important; }

    .page-header {
        background-color: #000;
        border-bottom: 2px solid #d8e377;
        padding: 60px 0;
        margin-bottom: 40px;
    }

    .match-section-title {
        font-family: 'Teko', sans-serif;
        border-left: 5px solid #d8e377;
        padding-left: 15px;
        margin-bottom: 20px;
        color: #fff;
    }

    .match-list-item {
        background: #111;
        border: 1px solid #333;
        padding: 20px;
        margin-bottom: 10px;
        border-radius: 5px;
    }

    .match-date { color: #888; font-size: 0.9rem; text-transform: uppercase; }

    .match-teams {
        font-size: 1.4rem;
        font-weight: bold;
        color: white;
        font-family: 'Teko', sans-serif;
        letter-spacing: 1px;
    }

    /* Result Badges */
    .badge-win { background-color: #198754; color: white; padding: 5px 15px; border-radius: 4px; font-weight: bold; }
    .badge-loss { background-color: #dc3545; color: white; padding: 5px 15px; border-radius: 4px; font-weight: bold; }
    .badge-draw { background-color: #6c757d; color: white; padding: 5px 15px; border-radius: 4px; font-weight: bold; }
    .badge-soon { background-color: #333; color: #aaa; padding: 5px 15px; border: 1px solid #555; border-radius: 4px; }
</style>

<div class="page-header text-center">
    <h1 class="display-3 fw-bold text-white mb-0" style="font-family: 'Teko', sans-serif;">SEASON CALENDAR</h1>
    <p class="text-secondary mt-2">CHALLENGE CUP & URC FIXTURES</p>

    {% if current_user.is_authenticated and current_user.is_admin %}
        <div class="mt-4">
            <a href="{{ url_for('create_match') }}" class="btn btn-warning fw-bold px-4">+ ADD NEW MATCH</a>
        </div>
    {% endif %}
</div>

<div class="container mb-5">
    <div class="row">

        <div class="col-lg-8">

            <h2 class="match-section-title">UPCOMING FIXTURES</h2>
            {% if upcoming %}
                {% for match in upcoming %}
                <div class="match-list-item d-flex justify-content-between align-items-center">
                    <div>
                        <div class="match-date">{{ match.date.strftime('%b %d | %H:%M') }} - {{ match.venue }}</div>
                        <div class="match-teams">
                            {{ match.home_team }} <span class="text-secondary">vs</span> {{ match.away_team }}
                        </div>
                    </div>
                    <div class="text-end">
                        {% if match.ticket_link %}
                            <a href="{{ match.ticket_link }}" target="_blank" class="btn btn-sm neon-bg fw-bold">BUY TICKET</a>
                        {% else %}
                            <span class="badge-soon">SOON</span>
                        {% endif %}

                        {% if current_user.is_admin %}
                            <div class="mt-2">
                                <a href="{{ url_for('update_match', match_id=match.id) }}" class="text-warning small me-2">Edit</a>
                                <form action="{{ url_for('delete_match', match_id=match.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete this match?');">
                                    <button type="submit" class="btn btn-link p-0 text-danger small" style="text-decoration: none;">Delete</button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No upcoming games scheduled.</p>
            {% endif %}

            <h2 class="match-section-title mt-5">MATCH RESULTS</h2>
            {% if played %}
                {% for match in played %}
                <div class="match-list-item d-flex justify-content-between align-items-center"
                     style="border-left: 5px solid {% if match.outcome == 'win' %}#198754{% elif match.outcome == 'loss' %}#dc3545{% else %}#6c757d{% endif %};">
                    <div>
                        <div class="match-date">{{ match.date.strftime('%b %d, %Y') }}</div>
                        <div class="match-teams">
                            {{ match.home_team }} <span class="text-warning">{{ match.home_score }}</span> - <span class="text-warning">{{ match.away_score }}</span> {{ match.away_team }}
                        </div>
                    </div>
                    <div class="text-end">
                        {% if match.outcome == 'win' %}
                            <span class="badge-win">WIN</span>
                        {% elif match.outcome == 'loss' %}
                            <span class="badge-loss">LOSS</span>
                        {% else %}
                            <span class="badge-draw">DRAW</span>
                        {% endif %}

                        {% if current_user.is_admin %}
                            <div class="mt-2">
                                <a href="{{ url_for('update_match', match_id=match.id) }}" class="text-warning small me-2">Edit</a>
                                <form action="{{ url_for('delete_match', match_id=match.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete this result?');">
                                    <button type="submit" class="btn btn-link p-0 text-danger small" style="text-decoration: none;">Delete</button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No results yet.</p>
            {% endif %}
        </div>

        <div class="col-lg-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="match-section-title mb-0">STANDINGS</h2>
                {% if current_user.is_admin %}
                    <a href="{{ url_for('create_standing') }}" class="btn btn-sm btn-outline-warning">+ ADD TEAM</a>
                {% endif %}
            </div>

            <div class="p-3" style="background: #111; border: 1px solid #333;">
                <table class="table table-dark table-borderless table-sm mb-0">
                    <thead>
                        <tr class="text-secondary">
                            <th>Pos</th>
                            <th>Team</th>
                            <th class="text-center">PL</th>
                            <th class="text-center">PTS</th>
                            {% if current_user.is_admin %}<th></th>{% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in table %}
                        <tr class="{{ 'bg-secondary text-white fw-bold' if row.team_name == 'Black Lion' else 'text-secondary' }}">
                            <td class="align-middle">{{ row.position }}</td>
                            <td class="align-middle">{{ row.team_name }}</td>
                            <td class="text-center align-middle">{{ row.played }}</td>
                            <td class="text-center text-white align-middle">{{ row.points }}</td>

                            {% if current_user.is_admin %}
                                <td class="text-end">
                                    <a href="{{ url_for('update_standing', standing_id=row.id) }}" class="text-warning small me-2" style="text-decoration: none;">✏️</a>
                                    <form action="{{ url_for('delete_standing', standing_id=row.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete this team?');">
                                        <button type="submit" class="btn btn-link p-0 text-danger small" style="text-decoration: none;">X</button>
                                    </form>
                                </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                {% if not table %}
                    <div class="text-center mt-3 text-muted small">Table is empty. Add a team!</div>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock content %}